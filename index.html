<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECä¾¡æ ¼è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .settings-section {
            background: #f8f9fa;
            padding: 25px;
            border-bottom: 2px solid #e9ecef;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group input {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .refresh-rate-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .refresh-rate-btn:hover {
            background: #138496;
        }

        .loading {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .save-settings-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .save-settings-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            padding: 30px;
        }

        .calculator-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
        }

        .calculator-card:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px);
        }

        .calculator-card.cost-calculation {
            background: #fff8f0;
            border: 2px solid #ffdbbb;
        }

        .calculator-card.cost-calculation:hover {
            box-shadow: 0 8px 24px rgba(255, 152, 0, 0.15);
        }

        .section-divider {
            grid-column: 1 / -1;
            margin: 30px 0;
            text-align: center;
        }

        .section-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            display: inline-block;
            font-size: 1.3em;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .section-title.cost-section {
            background: linear-gradient(135deg, #ff9800 0%, #ff6f00 100%);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .calculator-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            font-size: 1.5em;
        }

        .calculator-card.cost-calculation h2 {
            color: #ff6f00;
            border-bottom: 3px solid #ff9800;
        }

        .calc-input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .calc-input-group {
            display: flex;
            flex-direction: column;
        }

        .calc-input-group label {
            font-weight: 600;
            margin-bottom: 6px;
            color: #495057;
            font-size: 0.9em;
        }

        .calc-input-group input,
        .calc-input-group select {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 15px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .result-section {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .result-item label {
            display: block;
            font-size: 0.85em;
            color: #6c757d;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .result-item .value {
            font-size: 1.3em;
            font-weight: 700;
            color: #212529;
        }

        .result-item.highlight .value {
            color: #667eea;
            font-size: 1.5em;
        }

        .tariff-table-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .tariff-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .tariff-table th,
        .tariff-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .tariff-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .tariff-table tr:hover {
            background: #f8f9fa;
        }

        @media (max-width: 1200px) {
            .settings-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .calc-input-row {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }

        .hidden {
            display: none;
        }

        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #856404;
        }

        .formula {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #0d47a1;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }

        .formula strong {
            color: #1565c0;
        }

        .tutorial-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            margin-left: 15px;
        }

        .tutorial-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s;
        }

        .modal-content h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .modal-content h3 {
            color: #764ba2;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .modal-content p {
            line-height: 1.8;
            color: #495057;
            margin-bottom: 15px;
        }

        .modal-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .modal-content li {
            margin-bottom: 10px;
            line-height: 1.6;
            color: #495057;
        }

        .close-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .step {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #667eea;
            margin-bottom: 15px;
            border-radius: 6px;
        }

        .step strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ECä¾¡æ ¼è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>
            <p>ä»•å…¥ã‚Œä¾¡æ ¼ã¨è²©å£²ä¾¡æ ¼ã‚’ç°¡å˜ã«è¨ˆç®—</p>
            <button class="tutorial-btn" onclick="openTutorial()">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</button>
        </div>

        <div class="settings-section">
            <h2 style="margin-bottom: 20px; color: #495057;">å…±é€šè¨­å®š</h2>
            <div class="settings-grid">
                <!-- 1æ®µç›®ï¼šç‚ºæ›¿ã€æ‰‹æ•°æ–™ç‡ã€åºƒå‘Šè²»ç‡ã€ãƒšã‚¤ã‚ªãƒ‹ã‚¢æ‰‹æ•°æ–™ -->
                <div class="input-group">
                    <label>
                        ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ (å††/ãƒ‰ãƒ«)
                        <button class="refresh-rate-btn" onclick="fetchExchangeRate()">æœ€æ–°å–å¾—</button>
                    </label>
                    <input type="number" id="exchangeRate" value="153.435" step="0.001">
                </div>
                <div class="input-group">
                    <label>æ‰‹æ•°æ–™ç‡ (%)</label>
                    <input type="number" id="feeRate" value="18" step="0.1">
                </div>
                <div class="input-group">
                    <label>åºƒå‘Šè²»ç‡ (%)</label>
                    <input type="number" id="adRate" value="10" step="0.1">
                </div>
                <div class="input-group">
                    <label>ãƒšã‚¤ã‚ªãƒ‹ã‚¢æ‰‹æ•°æ–™ (%)</label>
                    <input type="number" id="payoneerRate" value="2" step="0.1">
                </div>
                <div class="input-group">
                    <label>é€æ–™è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰</label>
                    <select id="shippingMode" onchange="toggleShippingMode()">
                        <option value="fixed">å›ºå®šé€æ–™</option>
                        <option value="table">ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—</option>
                    </select>
                </div>
                <!-- 2æ®µç›®ï¼šé–¢ç¨ç‡ã€VATç‡ã€é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡ã€ç±³å›½é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ã€MPFã€EUé€æ–™å·®é¡ -->
                <div class="input-group">
                    <label>é–¢ç¨ç‡ (%)</label>
                    <input type="number" id="tariffRate" value="15" step="0.1">
                </div>
                <div class="input-group">
                    <label>VATç‡ (%)</label>
                    <input type="number" id="vatRate" value="0" step="0.1">
                </div>
                <div class="input-group">
                    <label>é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡ (%)</label>
                    <input type="number" id="processingFeeRate" value="2.1" step="0.1">
                </div>
                <div class="input-group">
                    <label>ç±³å›½é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ (å††)</label>
                    <input type="number" id="mpf" value="296" step="1">
                </div>
                <div class="input-group">
                    <label>MPF ($) <span style="font-size: 0.85em; color: #6c757d;">â€»Cpasså…é™¤</span></label>
                    <input type="number" id="mpfUsd" value="0" step="0.01">
                </div>
                <div class="input-group">
                    <label>EUé€æ–™å·®é¡ (å††)</label>
                    <input type="number" id="euShippingDiff" value="0" step="10">
                </div>
            </div>

            <!-- è‡ªå‹•é¸æŠè¨­å®šï¼ˆå…±é€šï¼‰ -->
            <div style="margin-top: 20px; padding: 20px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
                <h3 style="margin-bottom: 15px; color: #856404;">âš™ï¸ é…é€æ–¹æ³•è‡ªå‹•é¸æŠè¨­å®š</h3>
                <div class="settings-grid">
                    <div class="input-group">
                        <label>é€æ–™åˆ‡æ›¿åŸºæº–é‡‘é¡ (å††)</label>
                        <input type="number" id="shippingThreshold" value="5500" step="100">
                    </div>
                    <div class="input-group">
                        <label>ä½ä¾¡æ ¼å•†å“é…é€æ–¹æ³•</label>
                        <select id="lowPriceMethod">
                            <option value="SP">Small Packet</option>
                            <option value="CE">Cpass-Economy</option>
                            <option value="NONE">ãªã—</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>é«˜ä¾¡æ ¼å•†å“é…é€æ–¹æ³•</label>
                        <select id="highPriceMethod">
                            <option value="CF" selected>Cpass-FedEx</option>
                            <option value="CD">Cpass-DHL</option>
                            <option value="EL">eLogistics</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px; font-size: 0.9em; color: #856404;">
                    <strong>ğŸ’¡ è‡ªå‹•é¸æŠãƒ­ã‚¸ãƒƒã‚¯:</strong><br>
                    â€¢ ä»•å…¥ã‚Œä¾¡æ ¼ â‰¥ åˆ‡æ›¿åŸºæº–é‡‘é¡ â†’ é«˜ä¾¡æ ¼å•†å“é…é€æ–¹æ³•<br>
                    â€¢ ä»•å…¥ã‚Œä¾¡æ ¼ &lt; åˆ‡æ›¿åŸºæº–é‡‘é¡ â†’ ä½ä¾¡æ ¼å•†å“é…é€æ–¹æ³•ï¼ˆSmall Packetã¯2000gä»¥ä¸‹ã®ã¿ï¼‰<br>
                    â€¢ ä½ä¾¡æ ¼å•†å“é…é€æ–¹æ³•ãŒã€Œãªã—ã€ã®å ´åˆ â†’ å¸¸ã«é«˜ä¾¡æ ¼å•†å“é…é€æ–¹æ³•
                </div>
            </div>

            <!-- é€æ–™è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®è¨­å®š -->
            <div id="shippingSettings" style="margin-top: 20px;">
                <!-- å›ºå®šé€æ–™ãƒ¢ãƒ¼ãƒ‰ -->
                <div id="fixedShippingSettings" style="padding: 20px; background: #e8f5e9; border: 2px solid #4caf50; border-radius: 8px;">
                    <h3 style="margin-bottom: 15px; color: #2e7d32;">ğŸ’° å›ºå®šé€æ–™è¨­å®š</h3>
                    <div class="settings-grid">
                        <div class="input-group">
                            <label>é€æ–™ (å††)</label>
                            <input type="number" id="shippingCost" value="3000" step="100">
                        </div>
                    </div>
                </div>

                <!-- ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰ -->
                <div id="tableShippingSettings" class="hidden" style="padding: 20px; background: #e3f2fd; border: 2px solid #2196f3; border-radius: 8px;">
                    <h3 style="margin-bottom: 15px; color: #1565c0;">ğŸ“¦ ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—è¨­å®š</h3>

                    <!-- é‡é‡ãƒ»ã‚µã‚¤ã‚ºè¨­å®š -->
                    <div style="padding: 15px; background: white; border-radius: 5px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 15px 0; color: #1565c0; font-size: 1em;">é‡é‡ãƒ»ã‚µã‚¤ã‚º</h4>
                        <div class="settings-grid">
                            <div class="input-group">
                                <label>å®Ÿé‡é‡ (g)</label>
                                <input type="number" id="actualWeight" value="500" step="10" oninput="calculateEstimatedShipping()">
                            </div>
                            <div class="input-group">
                                <label>é•·ã• (cm)</label>
                                <input type="number" id="packageLength" value="20" step="1" oninput="calculateVolumetricWeight()">
                            </div>
                            <div class="input-group">
                                <label>å¹… (cm)</label>
                                <input type="number" id="packageWidth" value="20" step="1" oninput="calculateVolumetricWeight()">
                            </div>
                            <div class="input-group">
                                <label>é«˜ã• (cm)</label>
                                <input type="number" id="packageHeight" value="20" step="1" oninput="calculateVolumetricWeight()">
                            </div>
                            <div class="input-group">
                                <label>å®¹ç©é‡é‡ (g) <span style="font-size: 0.85em; color: #6c757d;">â€»è‡ªå‹•è¨ˆç®—</span></label>
                                <input type="number" id="volumetricWeight" value="0" step="10" readonly style="background-color: #e9ecef;">
                            </div>
                        </div>
                    </div>

                    <!-- é…é€æ–¹æ³•é¸æŠ -->
                    <div style="padding: 15px; background: white; border-radius: 5px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 15px 0; color: #1565c0; font-size: 1em;">é…é€æ–¹æ³•é¸æŠ</h4>
                        <div class="settings-grid">
                            <div class="input-group">
                                <label>é…é€æ–¹æ³•</label>
                                <select id="shippingMethod" onchange="calculateEstimatedShipping()">
                                    <option value="è‡ªå‹•é¸æŠ">è‡ªå‹•é¸æŠ</option>
                                    <option value="SP">Small Packet</option>
                                    <option value="CF">Cpass-FedEx</option>
                                    <option value="CD">Cpass-DHL</option>
                                    <option value="EL">eLogistics</option>
                                    <option value="CE">Cpass-Economy</option>
                                    <option value="EMS">EMS</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- é€æ–™è©¦ç®—çµæœ -->
                    <div id="shippingEstimate" style="padding: 15px; background: #fff9c4; border: 2px solid #fbc02d; border-radius: 5px; display: none;">
                        <h4 style="margin: 0 0 10px 0; color: #f57f17;">ğŸ’¡ é€æ–™è©¦ç®—</h4>
                        <div style="font-size: 1.1em;">
                            <strong>é…é€æ–¹æ³•:</strong> <span id="estimatedMethod">-</span><br>
                            <strong>èª²é‡‘é‡é‡:</strong> <span id="estimatedWeight">-</span> g<br>
                            <strong>é€æ–™:</strong> <span id="estimatedCost" style="font-size: 1.3em; color: #f57f17; font-weight: bold;">-</span> å††
                        </div>
                    </div>
                </div>
            </div>

            <button class="save-settings-btn" onclick="saveSettings()" style="margin-top: 20px;">è¨­å®šã‚’ä¿å­˜</button>
        </div>

        <div class="main-content">
            <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³: è²©å£²ä¾¡æ ¼ç®—å‡º -->
            <div class="section-divider">
                <div class="section-title">è²©å£²ä¾¡æ ¼ç®—å‡º</div>
            </div>

            <!-- åˆ©ç›Šé¡ãƒ™ãƒ¼ã‚¹: ä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ -->
            <div class="calculator-card">
                <h2>åˆ©ç›Šé¡ã§è¨ˆç®—ï¼ˆä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ï¼‰</h2>
                <div class="calc-input-row">
                    <div class="calc-input-group">
                        <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                        <input type="number" id="cost1" value="5000" step="1000">
                    </div>
                    <div class="calc-input-group">
                        <label>åˆ©ç›Šé¡ï¼ˆå††ï¼‰</label>
                        <input type="number" id="profit1" value="3000" step="100">
                    </div>
                </div>
                <button class="calculate-btn" onclick="calculatePriceFromCostProfit()">è¨ˆç®—ã™ã‚‹</button>
                <div id="result1" class="result-section hidden">
                    <h3>è¨ˆç®—çµæœ</h3>
                    <div class="result-grid">
                        <div class="result-item highlight">
                            <label>è²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <div class="value" id="sellingPrice1">-</div>
                        </div>
                        <div class="result-item">
                            <label>æƒ³å®šé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <div class="value" id="tariff1">-</div>
                        </div>
                        <div class="result-item highlight">
                            <label>DDPä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <div class="value" id="ddpPrice1">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>
                            <div class="value" id="shipping1">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>
                            <div class="value" id="refProfit1">-</div>
                        </div>
                    </div>
                    <div class="formula">
                        <strong>è¨ˆç®—å¼:</strong><br>
                        è²©å£²ä¾¡æ ¼ = (ä»•å…¥ã‚Œä¾¡æ ¼ + é€æ–™ + åˆ©ç›Šé¡) Ã· ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã· (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)<br>
                        æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— (é–¢ç¨ç‡ + VATç‡) Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + (MPFå†† Ã· ç‚ºæ›¿) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)<br>
                        DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨
                    </div>
                </div>
            </div>

            <!-- åˆ©ç›Šç‡ãƒ™ãƒ¼ã‚¹: ä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ -->
            <div class="calculator-card">
                <h2>åˆ©ç›Šç‡ã§è¨ˆç®—ï¼ˆä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ï¼‰</h2>
                <div class="calc-input-row">
                    <div class="calc-input-group">
                        <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                        <input type="number" id="cost2" value="5000" step="1000">
                    </div>
                    <div class="calc-input-group">
                        <label>åˆ©ç›Šç‡ (%)</label>
                        <input type="number" id="profitRate2" value="20" step="1">
                    </div>
                </div>
                <button class="calculate-btn" onclick="calculatePriceFromCostProfitRate()">è¨ˆç®—ã™ã‚‹</button>
                <div id="result2" class="result-section hidden">
                    <h3>è¨ˆç®—çµæœ</h3>
                    <div class="result-grid">
                        <div class="result-item highlight">
                            <label>è²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <div class="value" id="sellingPrice2">-</div>
                        </div>
                        <div class="result-item">
                            <label>æƒ³å®šé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <div class="value" id="tariff2">-</div>
                        </div>
                        <div class="result-item highlight">
                            <label>DDPä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <div class="value" id="ddpPrice2">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>
                            <div class="value" id="shipping2">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>
                            <div class="value" id="refProfit2">-</div>
                        </div>
                    </div>
                    <div class="formula">
                        <strong>è¨ˆç®—å¼:</strong><br>
                        è²©å£²ä¾¡æ ¼ = (ä»•å…¥ã‚Œä¾¡æ ¼ + é€æ–™) Ã· ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã· (1 - åˆ©ç›Šç‡ - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)<br>
                        æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— (é–¢ç¨ç‡ + VATç‡) Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + (MPFå†† Ã· ç‚ºæ›¿) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)<br>
                        DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨
                    </div>
                </div>
            </div>

            <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³: ä»•å…¥ã‚Œä¾¡æ ¼ç®—å‡º -->
            <div class="section-divider">
                <div class="section-title cost-section">ä»•å…¥ã‚Œä¾¡æ ¼ç®—å‡º</div>
            </div>

            <!-- åˆ©ç›Šé¡ãƒ™ãƒ¼ã‚¹: è²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œ -->
            <div class="calculator-card cost-calculation">
                <h2>åˆ©ç›Šé¡ã§è¨ˆç®—ï¼ˆè²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼‰</h2>
                <div class="calc-input-row">
                    <div class="calc-input-group">
                        <label>åˆ©ç›Šé¡ï¼ˆå††ï¼‰</label>
                        <input type="number" id="profit3" value="3000" step="100">
                    </div>
                </div>
                <button class="calculate-btn" onclick="calculateCostFromPriceProfit()">è¨ˆç®—ã™ã‚‹</button>

                <!-- DDUä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®— -->
                <div id="result3-ddu" class="result-section hidden">
                    <h3>DDUä¾¡æ ¼ï¼ˆé–¢ç¨æŠœãï¼‰ã‹ã‚‰ç®—å‡º</h3>
                    <div class="calc-input-row" style="margin-bottom: 15px;">
                        <div class="calc-input-group">
                            <label>DDUè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <input type="number" id="sellingPriceDDU3" value="500" step="10">
                        </div>
                    </div>
                    <div class="result-grid">
                        <div class="result-item highlight">
                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                            <div class="value" id="costPriceDDU3">-</div>
                        </div>
                        <div class="result-item">
                            <label>æƒ³å®šé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <div class="value" id="tariffDDU3">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>
                            <div class="value" id="shippingDDU3">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>
                            <div class="value" id="refProfitDDU3">-</div>
                        </div>
                    </div>
                    <div class="formula">
                        <strong>è¨ˆç®—å¼:</strong><br>
                        ä»•å…¥ã‚Œä¾¡æ ¼ = (DDUè²©å£²ä¾¡æ ¼ Ã— ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã— (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)) - é€æ–™ - åˆ©ç›Šé¡<br>
                        æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— (é–¢ç¨ç‡ + VATç‡) Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + (MPFå†† Ã· ç‚ºæ›¿) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)
                    </div>
                </div>

                <!-- DDPä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®— -->
                <div id="result3-ddp" class="result-section hidden" style="margin-top: 20px;">
                    <h3>DDPä¾¡æ ¼ï¼ˆé–¢ç¨è¾¼ã¿ï¼‰ã‹ã‚‰ç®—å‡º</h3>
                    <div class="calc-input-row" style="margin-bottom: 15px;">
                        <div class="calc-input-group">
                            <label>DDPè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <input type="number" id="sellingPriceDDP3" value="610" step="10">
                        </div>
                    </div>
                    <div class="result-grid">
                        <div class="result-item highlight">
                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                            <div class="value" id="costPriceDDP3">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>
                            <div class="value" id="shippingDDP3">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>
                            <div class="value" id="refProfitDDP3">-</div>
                        </div>
                    </div>
                    <div class="formula">
                        <strong>è¨ˆç®—å¼:</strong><br>
                        ä»•å…¥ã‚Œä¾¡æ ¼ = (DDPä¾¡æ ¼ Ã— ç‚ºæ›¿ Ã— netRate - åˆ©ç›Š - é€æ–™ - MPF - EUé€æ–™å·®é¡) Ã· (1 + (é–¢ç¨ç‡ + VATç‡) Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡))
                    </div>
                </div>
            </div>

            <!-- åˆ©ç›Šç‡ãƒ™ãƒ¼ã‚¹: è²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œ -->
            <div class="calculator-card cost-calculation">
                <h2>åˆ©ç›Šç‡ã§è¨ˆç®—ï¼ˆè²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼‰</h2>
                <div class="calc-input-row">
                    <div class="calc-input-group">
                        <label>åˆ©ç›Šç‡ (%)</label>
                        <input type="number" id="profitRate4" value="20" step="1">
                    </div>
                </div>
                <button class="calculate-btn" onclick="calculateCostFromPriceProfitRate()">è¨ˆç®—ã™ã‚‹</button>

                <!-- DDUä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®— -->
                <div id="result4-ddu" class="result-section hidden">
                    <h3>DDUä¾¡æ ¼ï¼ˆé–¢ç¨æŠœãï¼‰ã‹ã‚‰ç®—å‡º</h3>
                    <div class="calc-input-row" style="margin-bottom: 15px;">
                        <div class="calc-input-group">
                            <label>DDUè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <input type="number" id="sellingPriceDDU4" value="500" step="10">
                        </div>
                    </div>
                    <div class="result-grid">
                        <div class="result-item highlight">
                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                            <div class="value" id="costPriceDDU4">-</div>
                        </div>
                        <div class="result-item">
                            <label>æƒ³å®šé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <div class="value" id="tariffDDU4">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>
                            <div class="value" id="shippingDDU4">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>
                            <div class="value" id="refProfitDDU4">-</div>
                        </div>
                    </div>
                    <div class="formula">
                        <strong>è¨ˆç®—å¼:</strong><br>
                        ä»•å…¥ã‚Œä¾¡æ ¼ = (DDUè²©å£²ä¾¡æ ¼ Ã— ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã— (1 - åˆ©ç›Šç‡ - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)) - é€æ–™<br>
                        æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— (é–¢ç¨ç‡ + VATç‡) Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + (MPFå†† Ã· ç‚ºæ›¿) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)
                    </div>
                </div>

                <!-- DDPä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®— -->
                <div id="result4-ddp" class="result-section hidden" style="margin-top: 20px;">
                    <h3>DDPä¾¡æ ¼ï¼ˆé–¢ç¨è¾¼ã¿ï¼‰ã‹ã‚‰ç®—å‡º</h3>
                    <div class="calc-input-row" style="margin-bottom: 15px;">
                        <div class="calc-input-group">
                            <label>DDPè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>
                            <input type="number" id="sellingPriceDDP4" value="610" step="10">
                        </div>
                    </div>
                    <div class="result-grid">
                        <div class="result-item highlight">
                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                            <div class="value" id="costPriceDDP4">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>
                            <div class="value" id="shippingDDP4">-</div>
                        </div>
                        <div class="result-item">
                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>
                            <div class="value" id="refProfitDDP4">-</div>
                        </div>
                    </div>
                    <div class="formula">
                        <strong>è¨ˆç®—å¼:</strong><br>
                        ä»•å…¥ã‚Œä¾¡æ ¼ = (DDPä¾¡æ ¼ Ã— ç‚ºæ›¿ Ã— netRate - é€æ–™ - MPF - EUé€æ–™å·®é¡) Ã· (1 + (é–¢ç¨ç‡ + VATç‡) Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡))
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="tutorialModal" class="modal">
        <div class="modal-content">
            <h2>ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>

            <h3>æ¦‚è¦</h3>
            <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ECï¼ˆé›»å­å•†å–å¼•ï¼‰ã«ãŠã‘ã‚‹ä»•å…¥ã‚Œä¾¡æ ¼ã¨è²©å£²ä¾¡æ ¼ã‚’ç°¡å˜ã«è¨ˆç®—ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚é–¢ç¨ã€æ‰‹æ•°æ–™ã€é€æ–™ãªã©ã‚’è€ƒæ…®ã—ãŸæ­£ç¢ºãªä¾¡æ ¼è¨­å®šãŒå¯èƒ½ã§ã™ã€‚</p>

            <h3>å…±é€šè¨­å®šã«ã¤ã„ã¦</h3>
            <div class="step">
                <strong>ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ:</strong> USD/JPYã®ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã€‚ã€Œæœ€æ–°å–å¾—ã€ãƒœã‚¿ãƒ³ã§è‡ªå‹•å–å¾—å¯èƒ½ã§ã™ã€‚<br>
                <strong>æ‰‹æ•°æ–™ç‡:</strong> ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ‰‹æ•°æ–™ã®å‰²åˆï¼ˆ%ï¼‰<br>
                <strong>åºƒå‘Šè²»ç‡:</strong> å£²ä¸Šã«å¯¾ã™ã‚‹åºƒå‘Šè²»ã®å‰²åˆï¼ˆ%ï¼‰<br>
                <strong>ãƒšã‚¤ã‚ªãƒ‹ã‚¢æ‰‹æ•°æ–™:</strong> æ±ºæ¸ˆæ‰‹æ•°æ–™ã®å‰²åˆï¼ˆ%ï¼‰<br>
                <strong>é€æ–™:</strong> å•†å“ã®é€æ–™ï¼ˆå††ï¼‰<br>
                <strong>é–¢ç¨ç‡:</strong> é–¢ç¨ã®å‰²åˆï¼ˆ%ï¼‰<br>
                <strong>VATç‡:</strong> ä»˜åŠ ä¾¡å€¤ç¨ã®å‰²åˆï¼ˆ%ï¼‰<br>
                <strong>é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡:</strong> é€šé–¢å‡¦ç†ã«ã‹ã‹ã‚‹æ‰‹æ•°æ–™ã®å‰²åˆï¼ˆ%ï¼‰<br>
                <strong>MPF:</strong> Merchandise Processing Feeï¼ˆå›ºå®šæ‰‹æ•°æ–™ã€å††ï¼‰<br>
                <strong>EUé€æ–™å·®é¡:</strong> ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘å‘ã‘é€æ–™ã®å·®é¡ï¼ˆå††ã€é€šå¸¸ã¯0ï¼‰
            </div>

            <h3>æƒ³å®šé–¢ç¨ã®è¨ˆç®—å¼</h3>
            <div class="step">
                æƒ³å®šé–¢ç¨ã¯ä»¥ä¸‹ã®å¼ã§è¨ˆç®—ã•ã‚Œã¾ã™ï¼š<br>
                <code>æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— (é–¢ç¨ç‡ + VATç‡) Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + (MPFå†† Ã· ç‚ºæ›¿) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)</code>
            </div>

            <h3>4ã¤ã®è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰</h3>

            <div class="step">
                <strong>1. åˆ©ç›Šé¡ã§è¨ˆç®—ï¼ˆä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ï¼‰</strong><br>
                ä»•å…¥ã‚Œä¾¡æ ¼ã¨å¸Œæœ›ã™ã‚‹åˆ©ç›Šé¡ï¼ˆå††ï¼‰ã‹ã‚‰ã€å¿…è¦ãªè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰ã‚’è¨ˆç®—ã—ã¾ã™ã€‚<br>
                ä½¿ç”¨ä¾‹: ä»•å…¥ã‚ŒãŒ5,000å††ã§3,000å††ã®åˆ©ç›ŠãŒæ¬²ã—ã„å ´åˆã®è²©å£²ä¾¡æ ¼ã¯ï¼Ÿ
            </div>

            <div class="step">
                <strong>2. åˆ©ç›Šç‡ã§è¨ˆç®—ï¼ˆä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ï¼‰</strong><br>
                ä»•å…¥ã‚Œä¾¡æ ¼ã¨å¸Œæœ›ã™ã‚‹åˆ©ç›Šç‡ï¼ˆ%ï¼‰ã‹ã‚‰ã€å¿…è¦ãªè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰ã‚’è¨ˆç®—ã—ã¾ã™ã€‚<br>
                ä½¿ç”¨ä¾‹: ä»•å…¥ã‚ŒãŒ5,000å††ã§20%ã®åˆ©ç›Šç‡ã‚’ç¢ºä¿ã—ãŸã„å ´åˆã®è²©å£²ä¾¡æ ¼ã¯ï¼Ÿ
            </div>

            <div class="step">
                <strong>3. åˆ©ç›Šé¡ã§è¨ˆç®—ï¼ˆè²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼‰</strong><br>
                è²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰ã¨å¸Œæœ›ã™ã‚‹åˆ©ç›Šé¡ï¼ˆå††ï¼‰ã‹ã‚‰ã€é©åˆ‡ãªä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰ã‚’é€†ç®—ã—ã¾ã™ã€‚<br>
                DDUä¾¡æ ¼ï¼ˆé–¢ç¨æŠœãï¼‰ã¨DDPä¾¡æ ¼ï¼ˆé–¢ç¨è¾¼ã¿ï¼‰ã®ä¸¡æ–¹ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ã€‚<br>
                ä½¿ç”¨ä¾‹: 500ãƒ‰ãƒ«ã§è²©å£²ã—ã€3,000å††ã®åˆ©ç›Šã‚’å¾—ã‚‹ã«ã¯ã€ã„ãã‚‰ã¾ã§ä»•å…¥ã‚Œã‚‰ã‚Œã‚‹ï¼Ÿ
            </div>

            <div class="step">
                <strong>4. åˆ©ç›Šç‡ã§è¨ˆç®—ï¼ˆè²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼‰</strong><br>
                è²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰ã¨å¸Œæœ›ã™ã‚‹åˆ©ç›Šç‡ï¼ˆ%ï¼‰ã‹ã‚‰ã€é©åˆ‡ãªä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰ã‚’é€†ç®—ã—ã¾ã™ã€‚<br>
                DDUä¾¡æ ¼ï¼ˆé–¢ç¨æŠœãï¼‰ã¨DDPä¾¡æ ¼ï¼ˆé–¢ç¨è¾¼ã¿ï¼‰ã®ä¸¡æ–¹ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ã€‚<br>
                ä½¿ç”¨ä¾‹: 500ãƒ‰ãƒ«ã§è²©å£²ã—ã€20%ã®åˆ©ç›Šç‡ã‚’ç¢ºä¿ã™ã‚‹ã«ã¯ã€ã„ãã‚‰ã¾ã§ä»•å…¥ã‚Œã‚‰ã‚Œã‚‹ï¼Ÿ
            </div>

            <h3>DDU vs DDP ã«ã¤ã„ã¦</h3>
            <div class="step">
                <strong>DDUï¼ˆDelivered Duty Unpaidï¼‰:</strong> é–¢ç¨æŠœãã®ä¾¡æ ¼ã€‚è³¼å…¥è€…ãŒé–¢ç¨ã‚’è² æ‹…ã—ã¾ã™ã€‚<br>
                <strong>DDPï¼ˆDelivered Duty Paidï¼‰:</strong> é–¢ç¨è¾¼ã¿ã®ä¾¡æ ¼ã€‚è²©å£²è€…ãŒé–¢ç¨ã‚’è² æ‹…ã—ã€ä¾¡æ ¼ã«å«ã‚ã¾ã™ã€‚<br>
                <br>
                ä»•å…¥ã‚Œä¾¡æ ¼ç®—å‡ºã§ã¯ã€DDUä¾¡æ ¼ã¨DDPä¾¡æ ¼ã®ä¸¡æ–¹ã‚’åŒæ™‚ã«å…¥åŠ›ãƒ»è¨ˆç®—ã§ãã‚‹ã®ã§ã€ã©ã¡ã‚‰ã®è²©å£²æ–¹æ³•ã§ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚
            </div>

            <h3>è¨ˆç®—å¼ã®è¦‹æ–¹</h3>
            <p>å„è¨ˆç®—çµæœã®ä¸‹éƒ¨ã«ã¯ã€é’ã„èƒŒæ™¯ã®è¨ˆç®—å¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯å®Ÿéš›ã®æ•°å€¤ã§ã¯ãªãã€å¤‰æ•°åã§ç¤ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç†è§£ã™ã‚‹éš›ã«å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚</p>

            <h3>è¨­å®šã®ä¿å­˜</h3>
            <p>ã€Œè¨­å®šã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€å…±é€šè¨­å®šãŒãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã€æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã‚‚åŒã˜è¨­å®šãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>

            <button class="close-btn" onclick="closeTutorial()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // é€æ–™ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®Shipping_Ratesã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ï¼‰
        const SHIPPING_RATE_TABLE = {
            SP: [ // Small Packet
                { min: 1, max: 100, yen: 1290 }, { min: 101, max: 200, yen: 1500 }, { min: 201, max: 300, yen: 1710 },
                { min: 301, max: 400, yen: 1920 }, { min: 401, max: 500, yen: 1920 }, { min: 501, max: 600, yen: 2130 },
                { min: 601, max: 700, yen: 2550 }, { min: 701, max: 800, yen: 2760 }, { min: 801, max: 900, yen: 2970 },
                { min: 901, max: 1000, yen: 3180 }, { min: 1001, max: 1100, yen: 3390 }, { min: 1101, max: 1200, yen: 3600 },
                { min: 1201, max: 1250, yen: 3810 }, { min: 1251, max: 1300, yen: 3810 }, { min: 1301, max: 1400, yen: 4020 },
                { min: 1401, max: 1500, yen: 4230 }, { min: 1501, max: 1600, yen: 4440 }, { min: 1601, max: 1700, yen: 4650 },
                { min: 1701, max: 1750, yen: 4860 }, { min: 1751, max: 1800, yen: 4860 }, { min: 1801, max: 1900, yen: 5070 },
                { min: 1901, max: 2000, yen: 5280 }
            ],
            CE: [ // Cpass-Economy
                { min: 1, max: 100, yen: 1227 }, { min: 101, max: 200, yen: 1367 }, { min: 201, max: 300, yen: 1581 },
                { min: 301, max: 400, yen: 1778 }, { min: 401, max: 500, yen: 2060 }, { min: 501, max: 600, yen: 2222 },
                { min: 601, max: 700, yen: 2321 }, { min: 701, max: 800, yen: 2703 }, { min: 801, max: 900, yen: 2820 },
                { min: 901, max: 1000, yen: 3020 }, { min: 1001, max: 1100, yen: 3136 }, { min: 1101, max: 1200, yen: 3250 },
                { min: 1201, max: 1250, yen: 3366 }, { min: 1251, max: 1300, yen: 3366 }, { min: 1301, max: 1400, yen: 3704 },
                { min: 1401, max: 1500, yen: 3816 }, { min: 1501, max: 1600, yen: 3935 }, { min: 1601, max: 1700, yen: 4046 },
                { min: 1701, max: 1750, yen: 4165 }, { min: 1751, max: 1800, yen: 4165 }, { min: 1801, max: 1900, yen: 5056 },
                { min: 1901, max: 2000, yen: 5245 }, { min: 2001, max: 2500, yen: 5582 }, { min: 2501, max: 3000, yen: 6333 },
                { min: 3001, max: 3500, yen: 6958 }, { min: 3501, max: 4000, yen: 7704 }, { min: 4001, max: 4500, yen: 9135 },
                { min: 4501, max: 5000, yen: 11733 }, { min: 5001, max: 5500, yen: 12500 }, { min: 5501, max: 6000, yen: 13335 },
                { min: 6001, max: 6500, yen: 14160 }, { min: 6501, max: 7000, yen: 15209 }, { min: 7001, max: 7500, yen: 16058 },
                { min: 7501, max: 8000, yen: 16893 }, { min: 8001, max: 8500, yen: 17562 }, { min: 8501, max: 9000, yen: 18152 },
                { min: 9001, max: 9500, yen: 19106 }, { min: 9501, max: 10000, yen: 19639 }, { min: 10001, max: 10500, yen: 20276 },
                { min: 10501, max: 11000, yen: 20864 }, { min: 11001, max: 11500, yen: 21565 }, { min: 11501, max: 12000, yen: 22199 },
                { min: 12001, max: 12500, yen: 22887 }, { min: 12501, max: 13000, yen: 23466 }, { min: 13001, max: 13500, yen: 24054 },
                { min: 13501, max: 14000, yen: 24869 }, { min: 14001, max: 14500, yen: 25200 }, { min: 14501, max: 15000, yen: 25988 },
                { min: 15001, max: 15500, yen: 26656 }, { min: 15501, max: 16000, yen: 28149 }, { min: 16001, max: 16500, yen: 28775 },
                { min: 16501, max: 17000, yen: 29495 }, { min: 17001, max: 17500, yen: 30196 }, { min: 17501, max: 18000, yen: 30902 },
                { min: 18001, max: 18500, yen: 31478 }, { min: 18501, max: 19000, yen: 32204 }, { min: 19001, max: 19500, yen: 32936 },
                { min: 19501, max: 20000, yen: 33947 }, { min: 20001, max: 20500, yen: 34655 }, { min: 20501, max: 21000, yen: 35426 },
                { min: 21001, max: 21500, yen: 36145 }, { min: 21501, max: 22000, yen: 36859 }, { min: 22001, max: 22500, yen: 37602 },
                { min: 22501, max: 23000, yen: 38516 }, { min: 23001, max: 23500, yen: 39084 }, { min: 23501, max: 24000, yen: 39678 },
                { min: 24001, max: 24500, yen: 40374 }, { min: 24501, max: 25000, yen: 40955 }, { min: 25001, max: 26000, yen: null },
                { min: 26001, max: 27000, yen: null }, { min: 27001, max: 28000, yen: null }, { min: 28001, max: 29000, yen: null },
                { min: 29001, max: 30000, yen: null }
            ],
            EMS: [ // EMS
                { min: 1, max: 100, yen: 3900 }, { min: 101, max: 500, yen: 3900 }, { min: 501, max: 600, yen: 4180 },
                { min: 601, max: 700, yen: 4460 }, { min: 701, max: 800, yen: 4740 }, { min: 801, max: 900, yen: 5020 },
                { min: 901, max: 1000, yen: 5300 }, { min: 1001, max: 1250, yen: 5990 }, { min: 1251, max: 1300, yen: 6600 },
                { min: 1301, max: 1500, yen: 6600 }, { min: 1501, max: 1750, yen: 7290 }, { min: 1751, max: 1800, yen: 7900 },
                { min: 1801, max: 2000, yen: 7900 }, { min: 2001, max: 2500, yen: 9100 }, { min: 2501, max: 3000, yen: 10300 },
                { min: 3001, max: 3500, yen: 11500 }, { min: 3501, max: 4000, yen: 12700 }, { min: 4001, max: 4500, yen: 13900 },
                { min: 4501, max: 5000, yen: 15100 }, { min: 5001, max: 5500, yen: 16300 }, { min: 5501, max: 6500, yen: 17500 },
                { min: 6501, max: 7500, yen: 19900 }, { min: 7501, max: 8500, yen: 22300 }, { min: 8501, max: 9500, yen: 24700 },
                { min: 9501, max: 10500, yen: 27100 }, { min: 10501, max: 11500, yen: 29500 }, { min: 11501, max: 12500, yen: 31900 },
                { min: 12501, max: 13500, yen: 34300 }, { min: 13501, max: 14500, yen: 36700 }, { min: 14501, max: 15500, yen: 39100 },
                { min: 15501, max: 16500, yen: 41500 }, { min: 16501, max: 17500, yen: 43900 }, { min: 17501, max: 18500, yen: 46300 },
                { min: 18501, max: 19500, yen: 48700 }, { min: 19501, max: 20500, yen: 51100 }, { min: 20501, max: 21500, yen: 53500 },
                { min: 21501, max: 22500, yen: 55900 }, { min: 22501, max: 23500, yen: 58300 }, { min: 23501, max: 24500, yen: 60700 },
                { min: 24501, max: 25000, yen: 63100 }, { min: 25001, max: 26000, yen: 65500 }, { min: 26001, max: 27000, yen: 67900 },
                { min: 27001, max: 28000, yen: 70300 }, { min: 28001, max: 29000, yen: 72700 }, { min: 29001, max: 30000, yen: 75100 }
            ],
            CF: [ // Cpass-FedEx
                { min: 1, max: 1000, yen: 1984 }, { min: 1001, max: 1500, yen: 2439 }, { min: 1501, max: 2000, yen: 2666 },
                { min: 2001, max: 2500, yen: 2918 }, { min: 2501, max: 3000, yen: 3173 }, { min: 3001, max: 3500, yen: 3329 },
                { min: 3501, max: 4000, yen: 3382 }, { min: 4001, max: 4500, yen: 3786 }, { min: 4501, max: 5000, yen: 4188 },
                { min: 5001, max: 5500, yen: 4495 }, { min: 5501, max: 6000, yen: 4805 }, { min: 6001, max: 6500, yen: 5114 },
                { min: 6501, max: 7000, yen: 5465 }, { min: 7001, max: 7500, yen: 5893 }, { min: 7501, max: 8000, yen: 6267 },
                { min: 8001, max: 8500, yen: 6444 }, { min: 8501, max: 9000, yen: 6621 }, { min: 9001, max: 9500, yen: 6797 },
                { min: 9501, max: 10000, yen: 8327 }, { min: 10001, max: 10500, yen: 8539 }, { min: 10501, max: 11000, yen: 8765 },
                { min: 11001, max: 11500, yen: 8991 }, { min: 11501, max: 12000, yen: 9217 }, { min: 12001, max: 12500, yen: 9444 },
                { min: 12501, max: 13000, yen: 10790 }, { min: 13001, max: 13500, yen: 11043 }, { min: 13501, max: 14000, yen: 11295 },
                { min: 14001, max: 14500, yen: 11548 }, { min: 14501, max: 15000, yen: 11800 }, { min: 15001, max: 15500, yen: 12052 },
                { min: 15501, max: 16000, yen: 12305 }, { min: 16001, max: 16500, yen: 13855 }, { min: 16501, max: 17000, yen: 14133 },
                { min: 17001, max: 17500, yen: 14411 }, { min: 17501, max: 18000, yen: 14690 }, { min: 18001, max: 18500, yen: 14969 },
                { min: 18501, max: 19000, yen: 15246 }, { min: 19001, max: 19500, yen: 15525 }, { min: 19501, max: 20000, yen: 15804 },
                { min: 20001, max: 20500, yen: 16082 }, { min: 20501, max: 21000, yen: 18179 }, { min: 21001, max: 21500, yen: 19099 },
                { min: 21501, max: 22000, yen: 20020 }, { min: 22001, max: 22500, yen: 20940 }, { min: 22501, max: 23000, yen: 21860 },
                { min: 23001, max: 23500, yen: 22780 }, { min: 23501, max: 24000, yen: 23700 }, { min: 24001, max: 24500, yen: 24621 },
                { min: 24501, max: 25000, yen: 25541 }, { min: 25001, max: 26000, yen: 26461 }, { min: 26001, max: 27000, yen: 27381 },
                { min: 27001, max: 28000, yen: 28301 }, { min: 28001, max: 29000, yen: 30096 }, { min: 29001, max: 30000, yen: 31008 },
                { min: 30001, max: Infinity, yen: 31920 }
            ],
            CD: [ // Cpass-DHL
                { min: 1, max: 1000, yen: 2191 }, { min: 1001, max: 1500, yen: 2482 }, { min: 1501, max: 2000, yen: 2588 },
                { min: 2001, max: 2500, yen: 2719 }, { min: 2501, max: 3000, yen: 3040 }, { min: 3001, max: 3500, yen: 3358 },
                { min: 3501, max: 4000, yen: 3753 }, { min: 4001, max: 4500, yen: 4079 }, { min: 4501, max: 5000, yen: 4406 },
                { min: 5001, max: 5500, yen: 4732 }, { min: 5501, max: 6000, yen: 5058 }, { min: 6001, max: 6500, yen: 5383 },
                { min: 6501, max: 7000, yen: 5753 }, { min: 7001, max: 7500, yen: 6203 }, { min: 7501, max: 8000, yen: 6652 },
                { min: 8001, max: 8500, yen: 7102 }, { min: 8501, max: 9000, yen: 7550 }, { min: 9001, max: 9500, yen: 7999 },
                { min: 9501, max: 10000, yen: 8449 }, { min: 10001, max: 10500, yen: 8898 }, { min: 10501, max: 11000, yen: 9347 },
                { min: 11001, max: 11500, yen: 9796 }, { min: 11501, max: 12000, yen: 10246 }, { min: 12001, max: 12500, yen: 10695 },
                { min: 12501, max: 13000, yen: 11144 }, { min: 13001, max: 13500, yen: 11594 }, { min: 13501, max: 14000, yen: 12042 },
                { min: 14001, max: 14500, yen: 12492 }, { min: 14501, max: 15000, yen: 12941 }, { min: 15001, max: 15500, yen: 13391 },
                { min: 15501, max: 16000, yen: 13840 }, { min: 16001, max: 16500, yen: 14290 }, { min: 16501, max: 17000, yen: 14739 },
                { min: 17001, max: 17500, yen: 15188 }, { min: 17501, max: 18000, yen: 15638 }, { min: 18001, max: 18500, yen: 16087 },
                { min: 18501, max: 19000, yen: 16537 }, { min: 19001, max: 19500, yen: 16986 }, { min: 19501, max: 20000, yen: 17436 },
                { min: 20001, max: 20500, yen: 17885 }, { min: 20501, max: 21000, yen: 18784 }, { min: 21001, max: 21500, yen: 19683 },
                { min: 21501, max: 22000, yen: 20582 }, { min: 22001, max: 22500, yen: 21481 }, { min: 22501, max: 23000, yen: 22380 },
                { min: 23001, max: 23500, yen: 23279 }, { min: 23501, max: 24000, yen: 24177 }, { min: 24001, max: 24500, yen: 25076 },
                { min: 24501, max: 25000, yen: 25966 }, { min: 25001, max: 26000, yen: 26865 }, { min: 26001, max: 27000, yen: 27761 },
                { min: 27001, max: 28000, yen: 28657 }, { min: 28001, max: 29000, yen: 29552 }, { min: 29001, max: 30000, yen: 30448 },
                { min: 30001, max: Infinity, yen: 31343 }
            ],
            EL: [ // eLogistics
                { min: 1, max: 1000, yen: 3700 }, { min: 1001, max: 1500, yen: 3900 }, { min: 1501, max: 2000, yen: 4100 },
                { min: 2001, max: 2500, yen: 4300 }, { min: 2501, max: 3000, yen: 5600 }, { min: 3001, max: 3500, yen: 5900 },
                { min: 3501, max: 4000, yen: 6300 }, { min: 4001, max: 4500, yen: 6600 }, { min: 4501, max: 5000, yen: 7200 },
                { min: 5001, max: 5500, yen: 7900 }, { min: 5501, max: 6000, yen: 8700 }, { min: 6001, max: 6500, yen: 10300 },
                { min: 6501, max: 7000, yen: 12200 }, { min: 7001, max: 7500, yen: 14100 }, { min: 7501, max: 8000, yen: 16000 },
                { min: 8001, max: 8500, yen: 17900 }, { min: 8501, max: 9000, yen: 19800 }, { min: 9001, max: 9500, yen: 21800 },
                { min: 9501, max: 10000, yen: 23700 }, { min: 10001, max: 10500, yen: 25600 }, { min: 10501, max: 11000, yen: 25800 },
                { min: 11001, max: 11500, yen: 26100 }, { min: 11501, max: 12000, yen: 26600 }, { min: 12001, max: 12500, yen: 27100 },
                { min: 12501, max: 13000, yen: 27500 }, { min: 13001, max: 13500, yen: 28000 }, { min: 13501, max: 14000, yen: 28500 },
                { min: 14001, max: 14500, yen: 28900 }, { min: 14501, max: 15000, yen: 29400 }, { min: 15001, max: 15500, yen: 29900 },
                { min: 15501, max: 16000, yen: 30400 }, { min: 16001, max: 16500, yen: 30800 }, { min: 16501, max: 17000, yen: 31300 },
                { min: 17001, max: 17500, yen: 31800 }, { min: 17501, max: 18000, yen: 32300 }, { min: 18001, max: 18500, yen: 32700 },
                { min: 18501, max: 19000, yen: 33200 }, { min: 19001, max: 19500, yen: 33700 }, { min: 19501, max: 20000, yen: 34200 },
                { min: 20001, max: 20500, yen: 34600 }, { min: 20501, max: 21000, yen: 35300 }, { min: 21001, max: 21500, yen: 35900 },
                { min: 21501, max: 22000, yen: 36500 }, { min: 22001, max: 22500, yen: 37100 }, { min: 22501, max: 23000, yen: 37800 },
                { min: 23001, max: 23500, yen: 38400 }, { min: 23501, max: 24000, yen: 39000 }, { min: 24001, max: 24500, yen: 39700 },
                { min: 24501, max: 25000, yen: 40300 }, { min: 25001, max: 26000, yen: 40900 }, { min: 26001, max: 27000, yen: 42200 },
                { min: 27001, max: 28000, yen: 43400 }, { min: 28001, max: 29000, yen: 44700 }, { min: 29001, max: 30000, yen: 45900 },
                { min: 30001, max: Infinity, yen: 47200 }
            ]
        };

        const SHIPPING_CONFIG = {
            fedexFuel: 0.2975,
            dhlFuel: 0.3,
            cpassDiscount: 0.03,
            fedexExtraPer500g: 115,
            dhlExtraPer500g: 96
        };

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
        function toggleShippingMode() {
            const mode = document.getElementById('shippingMode').value;
            const fixedSettings = document.getElementById('fixedShippingSettings');
            const tableSettings = document.getElementById('tableShippingSettings');

            if (mode === 'fixed') {
                fixedSettings.classList.remove('hidden');
                tableSettings.classList.add('hidden');
            } else {
                fixedSettings.classList.add('hidden');
                tableSettings.classList.remove('hidden');
                calculateVolumetricWeight();
            }
        }

        // å®¹ç©é‡é‡ã‚’è‡ªå‹•è¨ˆç®—
        function calculateVolumetricWeight() {
            const length = parseFloat(document.getElementById('packageLength').value) || 0;
            const width = parseFloat(document.getElementById('packageWidth').value) || 0;
            const height = parseFloat(document.getElementById('packageHeight').value) || 0;

            // å®¹ç©é‡é‡ = é•·ã• Ã— å¹… Ã— é«˜ã• Ã· 6000
            const volumetricWeight = Math.round((length * width * height) / 6);
            document.getElementById('volumetricWeight').value = volumetricWeight;

            // é€æ–™è©¦ç®—ã‚‚æ›´æ–°
            calculateEstimatedShipping();
        }

        // é€æ–™è©¦ç®—ã‚’è¨ˆç®—ãƒ»è¡¨ç¤º
        function calculateEstimatedShipping() {
            const actualWeight = parseFloat(document.getElementById('actualWeight').value) || 0;
            const volumetricWeight = parseFloat(document.getElementById('volumetricWeight').value) || 0;
            const method = document.getElementById('shippingMethod').value;

            // èª²é‡‘é‡é‡ã®è¨ˆç®—ï¼ˆSmall Packetã®å ´åˆã¯å®Ÿé‡é‡ã®ã¿ã€ãã‚Œä»¥å¤–ã¯maxï¼‰
            let chargeableWeight;
            if (method === 'SP') {
                chargeableWeight = actualWeight;
            } else {
                chargeableWeight = Math.max(actualWeight, volumetricWeight);
            }

            if (chargeableWeight === 0) {
                document.getElementById('shippingEstimate').style.display = 'none';
                return;
            }

            let shippingCost = 0;
            let actualMethod = method;

            // é…é€æ–¹æ³•ãŒã€Œè‡ªå‹•é¸æŠã€ã®å ´åˆ
            if (method === 'è‡ªå‹•é¸æŠ') {
                const settings = getSettings();
                const lowMethod = settings.lowPriceMethod || 'SP';
                const highMethod = settings.highPriceMethod || 'CF';

                // ä»®ã®ä»•å…¥ã‚Œä¾¡æ ¼ã‚’0ã¨ã—ã¦åˆ¤å®šï¼ˆå®Ÿéš›ã®è¨ˆç®—ã§ã¯å‹•çš„ã«å¤‰ã‚ã‚‹ï¼‰
                if (lowMethod === 'SP' && actualWeight <= 2000) {
                    shippingCost = getSmallPacketRate(actualWeight);
                    actualMethod = 'Small Packet';
                    chargeableWeight = actualWeight; // Small Packetã¯å®Ÿé‡é‡ã®ã¿
                } else {
                    chargeableWeight = Math.max(actualWeight, volumetricWeight);
                    shippingCost = calculateSpecificMethodRate(highMethod, actualWeight, chargeableWeight);
                    actualMethod = getMethodName(highMethod);
                }
            } else {
                shippingCost = calculateSpecificMethodRate(method, actualWeight, chargeableWeight);
                actualMethod = getMethodName(method);
            }

            // nullãƒã‚§ãƒƒã‚¯ï¼ˆSmall Packetã§2000gè¶…éã®å ´åˆï¼‰
            if (shippingCost === null || shippingCost === undefined) {
                document.getElementById('estimatedMethod').textContent = actualMethod;
                document.getElementById('estimatedWeight').textContent = chargeableWeight.toFixed(0);
                document.getElementById('estimatedCost').textContent = 'ä¸Šé™è¶…é';
                document.getElementById('estimatedCost').style.color = '#dc3545';
                document.getElementById('shippingEstimate').style.display = 'block';
                return;
            }

            // çµæœã‚’è¡¨ç¤º
            document.getElementById('estimatedMethod').textContent = actualMethod;
            document.getElementById('estimatedWeight').textContent = chargeableWeight.toFixed(0);
            document.getElementById('estimatedCost').textContent = `Â¥${shippingCost.toFixed(0)}`;
            document.getElementById('estimatedCost').style.color = '#007bff';
            document.getElementById('shippingEstimate').style.display = 'block';
        }

        // é…é€æ–¹æ³•ã‚³ãƒ¼ãƒ‰ã‚’æ—¥æœ¬èªåã«å¤‰æ›
        function getMethodName(code) {
            const methodNames = {
                'SP': 'Small Packet',
                'CF': 'Cpass-FedEx',
                'CD': 'Cpass-DHL',
                'EL': 'eLogistics',
                'CE': 'Cpass-Economy',
                'EMS': 'EMS'
            };
            return methodNames[code] || code;
        }

        // Small Packet æ–™é‡‘å–å¾—
        function getSmallPacketRate(weight) {
            // 2000gã‚’è¶…ãˆã‚‹å ´åˆã¯nullã‚’è¿”ã™
            if (weight > 2000) {
                return null;
            }
            for (let i = 0; i < SHIPPING_RATE_TABLE.SP.length; i++) {
                if (weight >= SHIPPING_RATE_TABLE.SP[i].min && weight <= SHIPPING_RATE_TABLE.SP[i].max) {
                    return SHIPPING_RATE_TABLE.SP[i].yen;
                }
            }
            return null;
        }

        // Cpass-FedEx æ–™é‡‘è¨ˆç®—
        function getCpassFedexRate(weight) {
            const rounded = Math.ceil(weight / 500) * 500;
            let base = null;

            for (let i = 0; i < SHIPPING_RATE_TABLE.CF.length; i++) {
                if (weight >= SHIPPING_RATE_TABLE.CF[i].min && weight <= SHIPPING_RATE_TABLE.CF[i].max) {
                    base = SHIPPING_RATE_TABLE.CF[i].yen;
                    break;
                }
            }

            if (!base) return 999999;

            const overUnits = Math.max(0, (rounded - 500) / 500);
            const extra = overUnits * SHIPPING_CONFIG.fedexExtraPer500g;
            const subTotal = base + extra;
            const fuel = subTotal * SHIPPING_CONFIG.fedexFuel;
            const discount = -(subTotal + fuel) * SHIPPING_CONFIG.cpassDiscount;
            return Math.round(subTotal + fuel + discount);
        }

        // Cpass-DHL æ–™é‡‘è¨ˆç®—
        function getCpassDHLRate(weight) {
            const rounded = Math.ceil(weight / 500) * 500;
            let base = null;

            for (let i = 0; i < SHIPPING_RATE_TABLE.CD.length; i++) {
                if (weight >= SHIPPING_RATE_TABLE.CD[i].min && weight <= SHIPPING_RATE_TABLE.CD[i].max) {
                    base = SHIPPING_RATE_TABLE.CD[i].yen;
                    break;
                }
            }

            if (!base) return 999999;

            const overUnits = Math.max(0, (rounded - 500) / 500);
            const extra = overUnits * SHIPPING_CONFIG.dhlExtraPer500g;
            const subTotal = base + extra;
            const fuel = subTotal * SHIPPING_CONFIG.dhlFuel;
            const discount = -(subTotal + fuel) * SHIPPING_CONFIG.cpassDiscount;
            return Math.round(subTotal + fuel + discount);
        }

        // eLogistics æ–™é‡‘è¨ˆç®—
        function getElogiRate(weight) {
            for (let i = 0; i < SHIPPING_RATE_TABLE.EL.length; i++) {
                if (weight >= SHIPPING_RATE_TABLE.EL[i].min && weight <= SHIPPING_RATE_TABLE.EL[i].max) {
                    return SHIPPING_RATE_TABLE.EL[i].yen;
                }
            }
            return 999999;
        }

        // Cpass-Economy æ–™é‡‘å–å¾—
        function getCpassEconomyRate(weight) {
            for (let i = 0; i < SHIPPING_RATE_TABLE.CE.length; i++) {
                if (weight >= SHIPPING_RATE_TABLE.CE[i].min && weight <= SHIPPING_RATE_TABLE.CE[i].max) {
                    const rate = SHIPPING_RATE_TABLE.CE[i].yen;
                    return rate !== null ? rate : 999999;
                }
            }
            return 999999;
        }

        // EMS æ–™é‡‘å–å¾—
        function getEMSRate(weight) {
            for (let i = 0; i < SHIPPING_RATE_TABLE.EMS.length; i++) {
                if (weight >= SHIPPING_RATE_TABLE.EMS[i].min && weight <= SHIPPING_RATE_TABLE.EMS[i].max) {
                    return SHIPPING_RATE_TABLE.EMS[i].yen;
                }
            }
            return 999999;
        }

        // é€æ–™è¨ˆç®—ãƒ¡ã‚¤ãƒ³é–¢æ•°
        function calculateShippingCost(costYen, actualWeight, volWeight, method, threshold, lowMethod, highMethod) {
            const chargeableWeight = Math.max(actualWeight || 0, volWeight || 0);

            // å›ºå®šãƒ¢ãƒ¼ãƒ‰åˆ¤å®š
            if (!actualWeight && !volWeight) {
                return parseFloat(document.getElementById('shippingCost').value) || 3000;
            }

            // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ¢ãƒ¼ãƒ‰
            if (method && method !== 'è‡ªå‹•é¸æŠ') {
                return calculateSpecificMethodRate(method, actualWeight, chargeableWeight);
            }

            // è‡ªå‹•é¸æŠ
            if (lowMethod === 'NONE' || costYen >= threshold) {
                return calculateSpecificMethodRate(highMethod, actualWeight, chargeableWeight);
            } else {
                if (lowMethod === 'SP' && actualWeight <= 2000) {
                    return getSmallPacketRate(actualWeight);
                } else {
                    return calculateSpecificMethodRate(highMethod, actualWeight, chargeableWeight);
                }
            }
        }

        // é…é€æ–¹æ³•åˆ¥ã®æ–™é‡‘è¨ˆç®—
        function calculateSpecificMethodRate(method, actualWeight, chargeableWeight) {
            switch(method) {
                case 'SP':
                    // Small Packetã¯å®Ÿé‡é‡ã®ã¿ä½¿ç”¨ã€2000gè¶…éæ™‚ã¯nullã‚’è¿”ã™
                    return getSmallPacketRate(actualWeight);
                case 'CF':
                    return getCpassFedexRate(chargeableWeight);
                case 'CD':
                    return getCpassDHLRate(chargeableWeight);
                case 'EL':
                    return getElogiRate(chargeableWeight);
                case 'CE':
                    return getCpassEconomyRate(chargeableWeight);
                case 'EMS':
                    return getEMSRate(chargeableWeight);
                default:
                    return getCpassDHLRate(chargeableWeight);
            }
        }

        // è¨­å®šã‚’å–å¾—
        function getSettings() {
            return {
                exchangeRate: parseFloat(document.getElementById('exchangeRate').value),
                tariffRate: parseFloat(document.getElementById('tariffRate').value) / 100,
                vatRate: parseFloat(document.getElementById('vatRate').value) / 100,
                processingFeeRate: parseFloat(document.getElementById('processingFeeRate').value) / 100,
                mpf: parseFloat(document.getElementById('mpf').value),
                mpfUsd: parseFloat(document.getElementById('mpfUsd').value),
                euShippingDiff: parseFloat(document.getElementById('euShippingDiff').value),
                adRate: parseFloat(document.getElementById('adRate').value) / 100,
                feeRate: parseFloat(document.getElementById('feeRate').value) / 100,
                payoneerRate: parseFloat(document.getElementById('payoneerRate').value) / 100,
                shippingMode: document.getElementById('shippingMode').value,
                shippingCost: parseFloat(document.getElementById('shippingCost').value),
                shippingThreshold: parseFloat(document.getElementById('shippingThreshold').value),
                lowPriceMethod: document.getElementById('lowPriceMethod').value,
                highPriceMethod: document.getElementById('highPriceMethod').value,
                actualWeight: parseFloat(document.getElementById('actualWeight').value) || 0,
                volumetricWeight: parseFloat(document.getElementById('volumetricWeight').value) || 0,
                packageLength: parseFloat(document.getElementById('packageLength').value) || 0,
                packageWidth: parseFloat(document.getElementById('packageWidth').value) || 0,
                packageHeight: parseFloat(document.getElementById('packageHeight').value) || 0,
                shippingMethod: document.getElementById('shippingMethod').value
            };
        }

        // è¨­å®šã‚’ä¿å­˜
        function saveSettings() {
            const settings = getSettings();
            localStorage.setItem('ecCalcSettings', JSON.stringify(settings));
            alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        // è¨­å®šã‚’èª­ã¿è¾¼ã¿
        function loadSettings() {
            const saved = localStorage.getItem('ecCalcSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('exchangeRate').value = settings.exchangeRate;
                document.getElementById('tariffRate').value = settings.tariffRate * 100;
                if (settings.vatRate !== undefined) {
                    document.getElementById('vatRate').value = settings.vatRate * 100;
                }
                if (settings.processingFeeRate !== undefined) {
                    document.getElementById('processingFeeRate').value = settings.processingFeeRate * 100;
                }
                if (settings.mpf !== undefined) {
                    document.getElementById('mpf').value = settings.mpf;
                }
                if (settings.mpfUsd !== undefined) {
                    document.getElementById('mpfUsd').value = settings.mpfUsd;
                }
                if (settings.euShippingDiff !== undefined) {
                    document.getElementById('euShippingDiff').value = settings.euShippingDiff;
                }
                document.getElementById('adRate').value = settings.adRate * 100;
                document.getElementById('feeRate').value = settings.feeRate * 100;
                document.getElementById('payoneerRate').value = settings.payoneerRate * 100;
                document.getElementById('shippingCost').value = settings.shippingCost;

                // é€æ–™é–¢é€£è¨­å®š
                if (settings.shippingMode !== undefined) {
                    document.getElementById('shippingMode').value = settings.shippingMode;
                    toggleShippingMode();
                }
                if (settings.shippingThreshold !== undefined) {
                    document.getElementById('shippingThreshold').value = settings.shippingThreshold;
                }
                if (settings.lowPriceMethod !== undefined) {
                    document.getElementById('lowPriceMethod').value = settings.lowPriceMethod;
                }
                if (settings.highPriceMethod !== undefined) {
                    document.getElementById('highPriceMethod').value = settings.highPriceMethod;
                }
                if (settings.actualWeight !== undefined) {
                    document.getElementById('actualWeight').value = settings.actualWeight;
                }
                if (settings.packageLength !== undefined) {
                    document.getElementById('packageLength').value = settings.packageLength;
                }
                if (settings.packageWidth !== undefined) {
                    document.getElementById('packageWidth').value = settings.packageWidth;
                }
                if (settings.packageHeight !== undefined) {
                    document.getElementById('packageHeight').value = settings.packageHeight;
                }
                if (settings.shippingMethod !== undefined) {
                    document.getElementById('shippingMethod').value = settings.shippingMethod;
                }
                // å®¹ç©é‡é‡ã‚’è¨ˆç®—
                calculateVolumetricWeight();
            }
        }

        // è¨ˆç®—1: åˆ©ç›Šé¡ã§ä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼
        function calculatePriceFromCostProfit() {
            const settings = getSettings();
            const costJPY = parseFloat(document.getElementById('cost1').value);
            const profitJPY = parseFloat(document.getElementById('profit1').value);

            // é€æ–™è¨ˆç®—
            const shippingCostJPY = calculateShippingCost(
                costJPY,
                settings.actualWeight,
                settings.volumetricWeight,
                settings.shippingMethod,
                settings.shippingThreshold,
                settings.lowPriceMethod,
                settings.highPriceMethod
            );

            // è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
            // è²©å£²ä¾¡æ ¼ = (ä»•å…¥ã‚Œ + é€æ–™ + åˆ©ç›Š) / ç‚ºæ›¿ / (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)
            const totalCostJPY = costJPY + shippingCostJPY + profitJPY;
            const netRate = 1 - settings.feeRate - settings.adRate - settings.payoneerRate;
            let sellingPriceUSD = totalCostJPY / settings.exchangeRate / netRate;

            // æƒ³å®šé–¢ç¨ = é–¢ç¨é¡ + é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ + (ç±³å›½é€šé–¢å‡¦ç†æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF$ + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)
            // é–¢ç¨é¡ = è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡
            // é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ = (è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡ Ã— é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡) + (è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡)
            let tariffUSD = sellingPriceUSD * settings.tariffRate * (1 + settings.processingFeeRate)
                          + sellingPriceUSD * settings.vatRate * settings.processingFeeRate
                          + (settings.mpf / settings.exchangeRate)
                          + settings.mpfUsd
                          + (settings.euShippingDiff / settings.exchangeRate);

            // DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨
            const ddpPrice = sellingPriceUSD + tariffUSD;

            // å‚è€ƒåˆ©ç›Šï¼ˆå†è¨ˆç®—ï¼‰
            const revenue = sellingPriceUSD * settings.exchangeRate;
            const fees = revenue * (settings.feeRate + settings.adRate + settings.payoneerRate);
            const refProfit = revenue - fees - costJPY - shippingCostJPY;

            // çµæœè¡¨ç¤º
            document.getElementById('result1').classList.remove('hidden');
            document.getElementById('sellingPrice1').textContent = `$${sellingPriceUSD.toFixed(2)}`;
            document.getElementById('tariff1').textContent = `$${tariffUSD.toFixed(2)}`;
            document.getElementById('ddpPrice1').textContent = `$${ddpPrice.toFixed(2)}`;
            document.getElementById('refProfit1').textContent = `Â¥${refProfit.toFixed(0)}`;
            document.getElementById('shipping1').textContent = `Â¥${shippingCostJPY.toFixed(0)}`;
        }

        // è¨ˆç®—2: åˆ©ç›Šç‡ã§ä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼
        function calculatePriceFromCostProfitRate() {
            const settings = getSettings();
            const costJPY = parseFloat(document.getElementById('cost2').value);
            const profitRate = parseFloat(document.getElementById('profitRate2').value) / 100;

            // é€æ–™è¨ˆç®—
            const shippingCostJPY = calculateShippingCost(
                costJPY,
                settings.actualWeight,
                settings.volumetricWeight,
                settings.shippingMethod,
                settings.shippingThreshold,
                settings.lowPriceMethod,
                settings.highPriceMethod
            );

            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å¼: B16 = (ä»•å…¥ã‚Œ + é€æ–™) / (1 - (åˆ©ç›Šç‡ + åºƒå‘Šè²»ç‡ + æ‰‹æ•°æ–™ç‡ + ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)) / ç‚ºæ›¿
            const baseCost = costJPY + shippingCostJPY;
            const netRate = 1 - profitRate - settings.feeRate - settings.adRate - settings.payoneerRate;
            let sellingPriceUSD = baseCost / settings.exchangeRate / netRate;

            // æƒ³å®šé–¢ç¨ = é–¢ç¨é¡ + é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ + (ç±³å›½é€šé–¢å‡¦ç†æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF$ + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)
            // é–¢ç¨é¡ = è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡
            // é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ = (è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡ Ã— é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡) + (è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡)
            let tariffUSD = sellingPriceUSD * settings.tariffRate * (1 + settings.processingFeeRate)
                          + sellingPriceUSD * settings.vatRate * settings.processingFeeRate
                          + (settings.mpf / settings.exchangeRate)
                          + settings.mpfUsd
                          + (settings.euShippingDiff / settings.exchangeRate);

            // DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨
            const ddpPrice = sellingPriceUSD + tariffUSD;

            const revenue = sellingPriceUSD * settings.exchangeRate;
            const fees = revenue * (settings.feeRate + settings.adRate + settings.payoneerRate);
            const refProfit = revenue - fees - costJPY - shippingCostJPY;

            document.getElementById('result2').classList.remove('hidden');
            document.getElementById('sellingPrice2').textContent = `$${sellingPriceUSD.toFixed(2)}`;
            document.getElementById('tariff2').textContent = `$${tariffUSD.toFixed(2)}`;
            document.getElementById('ddpPrice2').textContent = `$${ddpPrice.toFixed(2)}`;
            document.getElementById('refProfit2').textContent = `Â¥${refProfit.toFixed(0)}`;
            document.getElementById('shipping2').textContent = `Â¥${shippingCostJPY.toFixed(0)}`;
        }

        // è¨ˆç®—3: åˆ©ç›Šé¡ã§è²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œ
        function calculateCostFromPriceProfit() {
            const settings = getSettings();
            const profitJPY = parseFloat(document.getElementById('profit3').value);
            const netRate = 1 - settings.feeRate - settings.adRate - settings.payoneerRate;

            // DDUä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®—
            const sellingPriceDDU = parseFloat(document.getElementById('sellingPriceDDU3').value);
            const revenueDDU = sellingPriceDDU * settings.exchangeRate;
            const netRevenueDDU = revenueDDU * netRate;

            // é€æ–™è¨ˆç®—ï¼ˆä»®ã®ä»•å…¥ã‚Œä¾¡æ ¼ã§è¨ˆç®—ï¼‰
            const tempCostDDU = netRevenueDDU - profitJPY;
            const shippingCostDDU = calculateShippingCost(
                tempCostDDU,
                settings.actualWeight,
                settings.volumetricWeight,
                settings.shippingMethod,
                settings.shippingThreshold,
                settings.lowPriceMethod,
                settings.highPriceMethod
            );

            const costDDU = netRevenueDDU - shippingCostDDU - profitJPY;

            // æƒ³å®šé–¢ç¨
            const tariffDDU = sellingPriceDDU * settings.tariffRate * (1 + settings.processingFeeRate)
                            + sellingPriceDDU * settings.vatRate * settings.processingFeeRate
                            + (settings.mpf / settings.exchangeRate)
                            + settings.mpfUsd
                            + (settings.euShippingDiff / settings.exchangeRate);

            const feesDDU = revenueDDU * (settings.feeRate + settings.adRate + settings.payoneerRate);
            const refProfitDDU = revenueDDU - feesDDU - costDDU - settings.shippingCost;

            // DDPä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®—
            // DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨ ãªã®ã§ã€è²©å£²ä¾¡æ ¼ã‚’é€†ç®—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
            // ã—ã‹ã—ã€æƒ³å®šé–¢ç¨ã¯è²©å£²ä¾¡æ ¼ã«ä¾å­˜ã™ã‚‹ãŸã‚ã€åå¾©è¨ˆç®—ãŒå¿…è¦
            // ç°¡æ˜“çš„ã«ã¯ DDPä¾¡æ ¼ã‚’ç›´æ¥ä½¿ç”¨ã—ã¦ä»•å…¥ã‚Œä¾¡æ ¼ã‚’ç®—å‡º
            const sellingPriceDDP = parseFloat(document.getElementById('sellingPriceDDP3').value);
            const revenueDDP = sellingPriceDDP * settings.exchangeRate;
            const netRevenueDDP = revenueDDP * netRate;

            // ä»•å…¥ã‚Œä¾¡æ ¼ã‚’é€†ç®—ï¼ˆæƒ³å®šé–¢ç¨ã®è¨ˆç®—ãŒè¤‡é›‘ãªãŸã‚ã€ç°¡æ˜“è¨ˆç®—ï¼‰
            // ä»•å…¥ã‚Œä¾¡æ ¼ = (DDPä¾¡æ ¼ Ã— ç‚ºæ›¿ Ã— netRate - åˆ©ç›Š - é€æ–™ - MPF - EUé€æ–™å·®é¡) / (1 + (é–¢ç¨ç‡ + VATç‡) Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡))
            const costDDP = (netRevenueDDP - profitJPY - settings.shippingCost - settings.mpf - settings.euShippingDiff)
                          / (1 + (settings.tariffRate + settings.vatRate) * (1 + settings.processingFeeRate));

            // å‚è€ƒåˆ©ç›Š = è¨­å®šã—ãŸåˆ©ç›Šé¡ï¼ˆprofitJPYï¼‰ãã®ã‚‚ã®
            const refProfitDDP = profitJPY;

            // DDUçµæœè¡¨ç¤º
            document.getElementById('result3-ddu').classList.remove('hidden');
            document.getElementById('costPriceDDU3').textContent = `Â¥${costDDU.toFixed(0)}`;
            document.getElementById('tariffDDU3').textContent = `$${tariffDDU.toFixed(2)}`;
            document.getElementById('refProfitDDU3').textContent = `Â¥${refProfitDDU.toFixed(0)}`;
            document.getElementById('shippingDDU3').textContent = `Â¥${shippingCostDDU.toFixed(0)}`;

            // DDPçµæœè¡¨ç¤º
            const shippingCostDDP = calculateShippingCost(
                costDDP,
                settings.actualWeight,
                settings.volumetricWeight,
                settings.shippingMethod,
                settings.shippingThreshold,
                settings.lowPriceMethod,
                settings.highPriceMethod
            );
            document.getElementById('result3-ddp').classList.remove('hidden');
            document.getElementById('costPriceDDP3').textContent = `Â¥${costDDP.toFixed(0)}`;
            document.getElementById('refProfitDDP3').textContent = `Â¥${refProfitDDP.toFixed(0)}`;
            document.getElementById('shippingDDP3').textContent = `Â¥${shippingCostDDP.toFixed(0)}`;
        }

        // è¨ˆç®—4: åˆ©ç›Šç‡ã§è²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œ
        function calculateCostFromPriceProfitRate() {
            const settings = getSettings();
            const profitRate = parseFloat(document.getElementById('profitRate4').value) / 100;
            const netRate = 1 - profitRate - settings.feeRate - settings.adRate - settings.payoneerRate;

            // DDUä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®—
            const sellingPriceDDU = parseFloat(document.getElementById('sellingPriceDDU4').value);
            const revenueDDU = sellingPriceDDU * settings.exchangeRate;

            // é€æ–™è¨ˆç®—ï¼ˆä»®ã®ä»•å…¥ã‚Œä¾¡æ ¼ã§è¨ˆç®—ï¼‰
            const tempCostDDU = revenueDDU * netRate;
            const shippingCostDDU = calculateShippingCost(
                tempCostDDU,
                settings.actualWeight,
                settings.volumetricWeight,
                settings.shippingMethod,
                settings.shippingThreshold,
                settings.lowPriceMethod,
                settings.highPriceMethod
            );

            const costDDU = revenueDDU * netRate - shippingCostDDU;

            // æƒ³å®šé–¢ç¨
            const tariffDDU = sellingPriceDDU * settings.tariffRate * (1 + settings.processingFeeRate)
                            + sellingPriceDDU * settings.vatRate * settings.processingFeeRate
                            + (settings.mpf / settings.exchangeRate)
                            + settings.mpfUsd
                            + (settings.euShippingDiff / settings.exchangeRate);

            const feesDDU = revenueDDU * (settings.feeRate + settings.adRate + settings.payoneerRate);
            const refProfitDDU = revenueDDU - feesDDU - costDDU - settings.shippingCost;

            // DDPä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®—
            const sellingPriceDDP = parseFloat(document.getElementById('sellingPriceDDP4').value);
            const revenueDDP = sellingPriceDDP * settings.exchangeRate;
            const netRevenueDDP = revenueDDP * netRate;
            const costDDP = (netRevenueDDP - settings.shippingCost - settings.mpf - settings.euShippingDiff)
                          / (1 + (settings.tariffRate + settings.vatRate) * (1 + settings.processingFeeRate));

            // å‚è€ƒåˆ©ç›Š = åå…¥ Ã— åˆ©ç›Šç‡ï¼ˆæ‰‹æ•°æ–™å¼•ãå‰ã®åå…¥ã«å¯¾ã™ã‚‹åˆ©ç›Šç‡ï¼‰
            const feesDDP = revenueDDP * (settings.feeRate + settings.adRate + settings.payoneerRate);
            const tariffDDP = (costDDP / settings.exchangeRate) * (settings.tariffRate + settings.vatRate) * (1 + settings.processingFeeRate)
                            + (settings.mpf / settings.exchangeRate)
                            + (settings.euShippingDiff / settings.exchangeRate);
            const refProfitDDP = revenueDDP - feesDDP - costDDP - settings.shippingCost - (tariffDDP * settings.exchangeRate);

            // DDUçµæœè¡¨ç¤º
            document.getElementById('result4-ddu').classList.remove('hidden');
            document.getElementById('costPriceDDU4').textContent = `Â¥${costDDU.toFixed(0)}`;
            document.getElementById('tariffDDU4').textContent = `$${tariffDDU.toFixed(2)}`;
            document.getElementById('refProfitDDU4').textContent = `Â¥${refProfitDDU.toFixed(0)}`;
            document.getElementById('shippingDDU4').textContent = `Â¥${shippingCostDDU.toFixed(0)}`;

            // DDPçµæœè¡¨ç¤º
            const shippingCostDDP = calculateShippingCost(
                costDDP,
                settings.actualWeight,
                settings.volumetricWeight,
                settings.shippingMethod,
                settings.shippingThreshold,
                settings.lowPriceMethod,
                settings.highPriceMethod
            );
            document.getElementById('result4-ddp').classList.remove('hidden');
            document.getElementById('costPriceDDP4').textContent = `Â¥${costDDP.toFixed(0)}`;
            document.getElementById('refProfitDDP4').textContent = `Â¥${refProfitDDP.toFixed(0)}`;
            document.getElementById('shippingDDP4').textContent = `Â¥${shippingCostDDP.toFixed(0)}`;
        }

        // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’è‡ªå‹•å–å¾—
        async function fetchExchangeRate() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'å–å¾—ä¸­...';

            try {
                // ç„¡æ–™ã®APIï¼ˆexchangerate-api.comï¼‰ã‚’ä½¿ç”¨
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();

                if (data && data.rates && data.rates.JPY) {
                    const rate = data.rates.JPY;
                    document.getElementById('exchangeRate').value = rate.toFixed(3);
                    alert(`æœ€æ–°ã®ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ã—ã¾ã—ãŸ: $1 = Â¥${rate.toFixed(3)}`);
                } else {
                    throw new Error('ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Error fetching exchange rate:', error);
                alert('ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            } finally {
                btn.classList.remove('loading');
                btn.textContent = 'æœ€æ–°å–å¾—';
            }
        }

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹ã
        function openTutorial() {
            document.getElementById('tutorialModal').classList.add('show');
        }

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeTutorial() {
            document.getElementById('tutorialModal').classList.remove('show');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰é–‰ã˜ã‚‹
        window.onclick = function(event) {
            const modal = document.getElementById('tutorialModal');
            if (event.target === modal) {
                closeTutorial();
            }
        };

        // åˆæœŸåŒ–
        window.onload = function() {
            loadSettings();
            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—
            fetchExchangeRate();
        };
    </script>
</body>
</html>
